<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API - –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 7</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .test-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .api-url {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        
        .api-url code {
            font-family: 'Courier New', monospace;
            color: #2c3e50;
            font-size: 1.1rem;
            word-break: break-all;
        }
        
        .test-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }
        
        .primary-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }
        
        .primary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }
        
        .secondary-btn {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .secondary-btn:hover {
            background: #bdc3c7;
            transform: translateY(-2px);
        }
        
        .result-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .result-title {
            font-size: 1.3rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-loading {
            background: #fff3cd;
            color: #856404;
        }
        
        .dishes-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .dish-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dish-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .dish-info p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .dish-price {
            background: #2c3e50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .console-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .console-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #95a5a6;
            font-size: 0.8rem;
        }
        
        @media (max-width: 768px) {
            .test-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .test-btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã 7</h1>
        <p class="subtitle">–§—É–Ω–∫—Ü–∏—è loadDishes() –∏ —Ä–∞–±–æ—Ç–∞ —Å API</p>
        
        <div class="api-url">
            <strong>URL API:</strong><br>
            <code>https://edu.std-900.ist.mospolytech.ru/labs/api/dishes</code>
        </div>
        
        <div class="test-buttons">
            <button id="test-load-dishes" class="test-btn primary-btn">
                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å loadDishes()
            </button>
            <button id="test-xhr" class="test-btn secondary-btn">
                üîÑ –¢–µ—Å—Ç XMLHttpRequest
            </button>
            <button id="test-fallback" class="test-btn secondary-btn">
                üõ°Ô∏è –¢–µ—Å—Ç Fallback –¥–∞–Ω–Ω—ã—Ö
            </button>
            <button id="clear-console" class="test-btn secondary-btn">
                üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å
            </button>
        </div>
        
        <div class="result-section">
            <div class="result-header">
                <div class="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                <div id="status-badge" class="status-badge">–û–∂–∏–¥–∞–Ω–∏–µ</div>
            </div>
            
            <div id="dishes-list" class="dishes-list">
                <p style="color: #7f8c8d; text-align: center; padding: 40px;">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç—å loadDishes()" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                </p>
            </div>
            
            <div class="console-log">
                <div class="console-header">
                    <span>–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–∏–º–∏—Ç–∞—Ü–∏—è)</span>
                    <span>F12 –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏</span>
                </div>
                <div id="console-output"></div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API —Å–µ—Ä–≤–∏—Å -->
    <script src="api-service.js"></script>
    
    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const testBtn = document.getElementById('test-load-dishes');
        const xhrBtn = document.getElementById('test-xhr');
        const fallbackBtn = document.getElementById('test-fallback');
        const clearBtn = document.getElementById('clear-console');
        const dishesList = document.getElementById('dishes-list');
        const consoleOutput = document.getElementById('console-output');
        const statusBadge = document.getElementById('status-badge');
        
        // –õ–æ–≥ –≤ –∏–º–∏—Ç–∞—Ü–∏—é –∫–æ–Ω—Å–æ–ª–∏
        function logToConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#e74c3c' : 
                         type === 'success' ? '#27ae60' : '#3498db';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #95a5a6;">[${timestamp}]</span> 
                                 <span style="color: ${color};">${message}</span>`;
            consoleOutput.appendChild(logEntry);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // –¢–∞–∫–∂–µ –ª–æ–≥–∏—Ä—É–µ–º –≤ –Ω–∞—Å—Ç–æ—è—â—É—é –∫–æ–Ω—Å–æ–ª—å
            if (type === 'error') {
                console.error(message);
            } else if (type === 'success') {
                console.log('%c' + message, 'color: green');
            } else {
                console.log(message);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(text, type) {
            statusBadge.textContent = text;
            statusBadge.className = 'status-badge';
            
            if (type === 'success') {
                statusBadge.classList.add('status-success');
            } else if (type === 'error') {
                statusBadge.classList.add('status-error');
            } else if (type === 'loading') {
                statusBadge.classList.add('status-loading');
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª—é–¥
        function displayDishes(dishesArray) {
            if (!Array.isArray(dishesArray) || dishesArray.length === 0) {
                dishesList.innerHTML = '<p style="color: #e74c3c; text-align: center; padding: 40px;">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–ª—é–¥–∞</p>';
                return;
            }
            
            dishesList.innerHTML = '';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—ã–µ 10 –±–ª—é–¥
            dishesArray.slice(0, 10).forEach(dish => {
                const dishItem = document.createElement('div');
                dishItem.className = 'dish-item';
                
                dishItem.innerHTML = `
                    <div class="dish-info">
                        <h4>${dish.name}</h4>
                        <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${dish.category} | –¢–∏–ø: ${dish.kind} | –í–µ—Å: ${dish.count}</p>
                        <p>ID: ${dish.keyword}</p>
                    </div>
                    <div class="dish-price">${dish.price} ‚ÇΩ</div>
                `;
                
                dishesList.appendChild(dishItem);
            });
            
            if (dishesArray.length > 10) {
                const moreItem = document.createElement('div');
                moreItem.innerHTML = `<p style="text-align: center; color: #7f8c8d; margin-top: 10px;">
                    ... –∏ –µ—â—ë ${dishesArray.length - 10} –±–ª—é–¥
                </p>`;
                dishesList.appendChild(moreItem);
            }
        }
        
        // –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ loadDishes()
        testBtn.addEventListener('click', async function() {
            console.clear();
            logToConsole('=== –¢–ï–°–¢ –§–£–ù–ö–¶–ò–ò loadDishes() ===', 'info');
            logToConsole(`–ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ loadDishes()...`, 'info');
            logToConsole(`URL API: ${apiService.API_URL}`, 'info');
            
            updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            dishesList.innerHTML = '<p style="text-align: center; padding: 40px; color: #3498db;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å API...</p>';
            
            try {
                const startTime = Date.now();
                
                // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é loadDishes()
                const dishes = await apiService.loadDishes();
                
                const endTime = Date.now();
                const loadTime = endTime - startTime;
                
                logToConsole(`‚úÖ –£–°–ü–ï–•! –§—É–Ω–∫—Ü–∏—è loadDishes() –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${loadTime}ms`, 'success');
                logToConsole(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${dishes.length} –±–ª—é–¥`, 'success');
                
                if (dishes.length > 0) {
                    logToConsole(`–ü–µ—Ä–≤–æ–µ –±–ª—é–¥–æ: "${dishes[0].name}" (${dishes[0].price} ‚ÇΩ)`, 'success');
                }
                
                updateStatus(`–£—Å–ø–µ—à–Ω–æ: ${dishes.length} –±–ª—é–¥`, 'success');
                displayDishes(dishes);
                
            } catch (error) {
                logToConsole(`‚ùå –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
                updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fallback –¥–∞–Ω–Ω—ã–µ
                const fallbackDishes = [
                    {
                        "category": "soup",
                        "count": "350 –≥",
                        "image": "images/soup-murhs.jpg",
                        "keyword": "gaspacho",
                        "kind": "veg",
                        "name": "–ì–∞—Å–ø–∞—á–æ (Fallback)",
                        "price": 195
                    },
                    {
                        "category": "main",
                        "count": "400 –≥",
                        "image": "images/main-rise.jpg",
                        "keyword": "teriyaki_chicken",
                        "kind": "meat",
                        "name": "–ö—É—Ä–∏—Ü–∞ —Ç–µ—Ä–∏—è–∫–∏ —Å —Ä–∏—Å–æ–º (Fallback)",
                        "price": 350
                    }
                ];
                
                displayDishes(fallbackDishes);
                logToConsole('üîÑ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è fallback –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏', 'info');
            }
        });
        
        // –¢–µ—Å—Ç XMLHttpRequest –≤–µ—Ä—Å–∏–∏
        xhrBtn.addEventListener('click', function() {
            logToConsole('=== –¢–ï–°–¢ XMLHttpRequest –í–ï–†–°–ò–ò ===', 'info');
            
            if (typeof apiService.loadDishesXHR !== 'function') {
                logToConsole('‚ùå –§—É–Ω–∫—Ü–∏—è loadDishesXHR –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                return;
            }
            
            updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ XHR...', 'loading');
            
            apiService.loadDishesXHR()
                .then(dishes => {
                    logToConsole(`‚úÖ XMLHttpRequest: –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${dishes.length} –±–ª—é–¥`, 'success');
                    updateStatus(`XHR: ${dishes.length} –±–ª—é–¥`, 'success');
                    displayDishes(dishes);
                })
                .catch(error => {
                    logToConsole(`‚ùå XMLHttpRequest –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                    updateStatus('XHR –æ—à–∏–±–∫–∞', 'error');
                });
        });
        
        // –¢–µ—Å—Ç fallback –¥–∞–Ω–Ω—ã—Ö
        fallbackBtn.addEventListener('click', function() {
            logToConsole('=== –¢–ï–°–¢ FALLBACK –î–ê–ù–ù–´–• ===', 'info');
            
            // –°–æ–∑–¥–∞–µ–º –æ—à–∏–±–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞ fallback
            const originalFetch = window.fetch;
            window.fetch = function() {
                return Promise.reject(new Error('–ò–º–∏—Ç–∞—Ü–∏—è –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∞'));
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π loadDishes
            const originalLoadDishes = apiService.loadDishes;
            
            // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–ª—è —Ç–µ—Å—Ç–∞
            apiService.loadDishes = async function() {
                logToConsole('üîÑ –ò–º–∏—Ç–∞—Ü–∏—è –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏...', 'info');
                updateStatus('–¢–µ—Å—Ç fallback...', 'loading');
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const fallbackDishes = [
                    {
                        "category": "soup",
                        "count": "300 –≥",
                        "image": "images/soup-tomato.jpg",
                        "keyword": "test_fallback_1",
                        "kind": "veg",
                        "name": "–¢–µ—Å—Ç–æ–≤—ã–π —Å—É–ø (Fallback)",
                        "price": 150
                    },
                    {
                        "category": "drink",
                        "count": "250 –º–ª",
                        "image": "images/drink-orange.jpg",
                        "keyword": "test_fallback_2",
                        "kind": "cold",
                        "name": "–¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫ (Fallback)",
                        "price": 100
                    }
                ];
                
                logToConsole(`‚úÖ Fallback: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${fallbackDishes.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –±–ª—é–¥`, 'success');
                updateStatus(`Fallback: ${fallbackDishes.length} –±–ª—é–¥`, 'success');
                displayDishes(fallbackDishes);
                
                return fallbackDishes;
            };
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
            apiService.loadDishes().finally(() => {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
                window.fetch = originalFetch;
                apiService.loadDishes = originalLoadDishes;
            });
        });
        
        // –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Å–æ–ª–∏
        clearBtn.addEventListener('click', function() {
            consoleOutput.innerHTML = '';
            logToConsole('–ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞', 'info');
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        logToConsole('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã 7.', 'success');
        logToConsole(`API URL: ${apiService.API_URL}`, 'info');
        logToConsole('–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å loadDishes()" –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'info');
    </script>
</body>
</html>